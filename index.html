<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fakir Apparels - Washing Plant Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-tagline {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.15);
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.2);
            border-bottom: 3px solid white;
        }

        /* Main Content */
        .content-area {
            background: white;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tab-content {
            display: none;
            padding: 25px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 5px solid var(--secondary);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.active-batches {
            border-top-color: var(--secondary);
        }

        .stat-card.completed-batches {
            border-top-color: var(--success);
        }

        .stat-card.pending-steps {
            border-top-color: var(--warning);
        }

        .stat-card.today-batches {
            border-top-color: var(--danger);
        }

        .stat-card h3 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .stat-card .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-card .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
        }

        .filter-section select, 
        .filter-section input {
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            flex: 1;
            min-width: 200px;
        }

        .filter-section input:focus,
        .filter-section select:focus {
            outline: none;
            border-color: var(--secondary);
        }

        /* Batches List */
        .batches-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .batch-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 5px solid var(--secondary);
            transition: all 0.3s ease;
        }

        .batch-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            transform: translateX(5px);
        }

        .batch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .batch-id {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.2rem;
            font-family: monospace;
        }

        .batch-client {
            background: var(--secondary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .batch-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .batch-detail-item {
            display: flex;
            flex-direction: column;
        }

        .batch-detail-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .batch-detail-value {
            font-weight: 600;
            color: var(--dark);
        }

        /* Progress Section */
        .progress-section {
            margin-top: 15px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-text {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .progress-bar {
            height: 10px;
            background: var(--light);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--success));
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .steps-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .step-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .step-badge.completed {
            background: #d5f4e6;
            color: var(--success);
            border: 2px solid var(--success);
        }

        .step-badge.pending {
            background: #fff3cd;
            color: var(--warning);
            border: 2px solid var(--warning);
        }

        /* Generate Form Styles */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .btn-generate {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin: 30px auto;
            max-width: 400px;
        }

        .btn-generate:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        /* Batch Card Preview */
        .batch-card-preview {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 30px;
            border: 2px solid var(--secondary);
            display: none;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .card-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin: 25px 0;
        }

        @media (max-width: 768px) {
            .card-content {
                grid-template-columns: 1fr;
            }
        }

        .qr-container {
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qr-container canvas {
            max-width: 200px;
            height: auto !important;
        }

        .preview-details p {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .preview-details strong {
            color: var(--dark);
            min-width: 120px;
        }

        .card-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .btn-print, .btn-save {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-print {
            background: var(--primary);
            color: white;
        }

        .btn-save {
            background: var(--success);
            color: white;
        }

        .btn-print:hover, .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Scan Page Styles */
        .scan-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            min-height: 600px;
        }

        @media (max-width: 992px) {
            .scan-container {
                grid-template-columns: 1fr;
            }
        }

        .scanner-section {
            background: var(--light);
            padding: 25px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
        }

        #qr-reader {
            width: 100%;
            height: 350px;
            border: 3px solid var(--secondary);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            background: white;
        }

        .scan-instructions {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--secondary);
            flex: 1;
        }

        .scan-instructions h3 {
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scan-instructions ol {
            margin-left: 20px;
            margin-top: 10px;
        }

        .scan-instructions li {
            margin-bottom: 10px;
            color: #555;
            padding: 5px 0;
        }

        .process-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .process-section.active {
            display: block;
        }

        .batch-info {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0 25px;
        }

        .batch-info p {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .process-steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0 30px;
        }

        .process-step {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .process-step:hover {
            border-color: var(--secondary);
            background: #f0f8ff;
            transform: translateY(-2px);
        }

        .process-step.selected {
            border-color: var(--success);
            background: #d5f4e6;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.2);
        }

        .process-step.completed {
            border-color: var(--gray);
            background: var(--light);
            cursor: not-allowed;
            opacity: 0.7;
            transform: none !important;
        }

        .process-step i {
            font-size: 1.5rem;
            color: var(--secondary);
        }

        .process-step.completed i {
            color: var(--success);
        }

        .btn-complete {
            background: linear-gradient(135deg, var(--success) 0%, #219653 100%);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 20px;
        }

        .btn-complete:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }

        .btn-complete:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }

        /* Reports Page */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .report-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: var(--secondary);
        }

        .report-card h3 {
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-card p {
            color: var(--gray);
            line-height: 1.6;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: white;
            margin-top: 30px;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.4rem;
            }
            
            .nav-tab span {
                display: none;
            }
            
            .nav-tab i {
                font-size: 1.2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-section {
                flex-direction: column;
            }
            
            .filter-section select, 
            .filter-section input {
                width: 100%;
                min-width: unset;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .batch-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 15px;
            }
            
            .tab-content {
                padding: 15px;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-card .stat-value {
                font-size: 2rem;
            }
            
            .btn-print, .btn-save {
                width: 100%;
                justify-content: center;
            }
            
            .card-actions {
                flex-direction: column;
            }
        }

        /* Animation for QR scan */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .scanning {
            animation: pulse 1s infinite;
        }

        /* Status colors */
        .status-active {
            color: var(--success);
            font-weight: 600;
        }

        .status-completed {
            color: var(--secondary);
            font-weight: 600;
        }

        .status-delayed {
            color: var(--danger);
            font-weight: 600;
        }

        /* Loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--secondary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>
                <i class="fas fa-industry"></i>
                Fakir Apparels Washing Plant Management
            </h1>
            <div class="header-tagline">
                Real-time tracking of garment batches from washing to dispatch
            </div>
            
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="switchTab('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-tab" onclick="switchTab('generate')">
                    <i class="fas fa-qrcode"></i>
                    <span>Generate Batch</span>
                </div>
                <div class="nav-tab" onclick="switchTab('scan')">
                    <i class="fas fa-camera"></i>
                    <span>Scan QR</span>
                </div>
                <div class="nav-tab" onclick="switchTab('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="content-area">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card active-batches">
                        <h3><i class="fas fa-spinner"></i> Active Batches</h3>
                        <div class="stat-value" id="stat-active">0</div>
                        <div class="stat-label">Currently in production</div>
                    </div>
                    <div class="stat-card completed-batches">
                        <h3><i class="fas fa-check-circle"></i> Completed</h3>
                        <div class="stat-value" id="stat-completed">0</div>
                        <div class="stat-label">Batches finished today</div>
                    </div>
                    <div class="stat-card pending-steps">
                        <h3><i class="fas fa-clock"></i> Pending Steps</h3>
                        <div class="stat-value" id="stat-pending">0</div>
                        <div class="stat-label">Steps awaiting completion</div>
                    </div>
                    <div class="stat-card today-batches">
                        <h3><i class="fas fa-calendar-day"></i> Today's Batches</h3>
                        <div class="stat-value" id="stat-today">0</div>
                        <div class="stat-label">Created today</div>
                    </div>
                </div>

                <div class="filter-section">
                    <select id="filter-client" onchange="loadDashboard()">
                        <option value="all">All Clients</option>
                        <option value="Zara">Zara</option>
                        <option value="H&M">H&M</option>
                        <option value="Mango">Mango</option>
                        <option value="Uniqlo">Uniqlo</option>
                        <option value="LC Waikiki">LC Waikiki</option>
                    </select>
                    <select id="filter-status" onchange="loadDashboard()">
                        <option value="all">All Status</option>
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                        <option value="delayed">Delayed</option>
                    </select>
                    <input type="text" id="search-batch" placeholder="Search batch, style, or lot..." oninput="loadDashboard()">
                </div>

                <div class="batches-container" id="batches-container">
                    <!-- Batches will be loaded here -->
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No batches found</h3>
                        <p>Start by generating your first batch card</p>
                    </div>
                </div>
            </div>

            <!-- Generate Batch Tab -->
            <div id="generate" class="tab-content">
                <div class="form-container">
                    <h2 style="color: var(--primary); margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-plus-circle"></i> Create New Batch Card
                    </h2>
                    
                    <form id="batch-form" onsubmit="generateBatchCard(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="client-name"><i class="fas fa-building"></i> Client Name</label>
                                <select id="client-name" required>
                                    <option value="">Select Client</option>
                                    <option value="Zara">Zara</option>
                                    <option value="H&M">H&M</option>
                                    <option value="Mango">Mango</option>
                                    <option value="Uniqlo">Uniqlo</option>
                                    <option value="LC Waikiki">LC Waikiki</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="style-number"><i class="fas fa-tag"></i> Style Number</label>
                                <input type="text" id="style-number" placeholder="e.g., ZR-2024-001" required>
                            </div>

                            <div class="form-group">
                                <label for="lot-number"><i class="fas fa-barcode"></i> Lot Number</label>
                                <input type="text" id="lot-number" placeholder="e.g., LOT-001" required>
                            </div>

                            <div class="form-group">
                                <label for="garment-type"><i class="fas fa-tshirt"></i> Garment Type</label>
                                <select id="garment-type" required>
                                    <option value="">Select Garment Type</option>
                                    <option value="Denim Jacket">Denim Jacket</option>
                                    <option value="T-Shirt">T-Shirt</option>
                                    <option value="Jeans">Jeans</option>
                                    <option value="Shirt">Shirt</option>
                                    <option value="Trousers">Trousers</option>
                                    <option value="Sweater">Sweater</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="quantity"><i class="fas fa-calculator"></i> Quantity</label>
                                <input type="number" id="quantity" placeholder="e.g., 500" min="1" required>
                            </div>

                            <div class="form-group">
                                <label for="color"><i class="fas fa-palette"></i> Color</label>
                                <input type="text" id="color" placeholder="e.g., Dark Blue" required>
                            </div>

                            <div class="form-group">
                                <label for="priority"><i class="fas fa-exclamation-circle"></i> Priority</label>
                                <select id="priority">
                                    <option value="normal">Normal</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="operator"><i class="fas fa-user"></i> Operator</label>
                                <input type="text" id="operator" placeholder="Operator name" required>
                            </div>
                        </div>

                        <button type="submit" class="btn-generate">
                            <i class="fas fa-qrcode"></i> Generate Batch Card & QR Code
                        </button>
                    </form>

                    <div class="batch-card-preview" id="batch-card-preview">
                        <div class="preview-header">
                            <h3 style="color: var(--primary); display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-clipboard-check"></i> Batch Card Preview
                            </h3>
                            <div class="status-active">● READY FOR PRINT</div>
                        </div>
                        
                        <div class="card-content">
                            <div class="qr-container">
                                <div id="qrcode"></div>
                            </div>
                            <div class="preview-details">
                                <p><strong>Batch ID:</strong> <span id="display-batch-id"></span></p>
                                <p><strong>Client:</strong> <span id="display-client"></span></p>
                                <p><strong>Style:</strong> <span id="display-style"></span></p>
                                <p><strong>Lot:</strong> <span id="display-lot"></span></p>
                                <p><strong>Garment:</strong> <span id="display-garment"></span></p>
                                <p><strong>Quantity:</strong> <span id="display-quantity"></span></p>
                                <p><strong>Color:</strong> <span id="display-color"></span></p>
                                <p><strong>Priority:</strong> <span id="display-priority"></span></p>
                                <p><strong>Operator:</strong> <span id="display-operator"></span></p>
                                <p><strong>Date:</strong> <span id="display-date"></span></p>
                            </div>
                        </div>
                        
                        <div class="card-actions">
                            <button onclick="printBatchCard()" class="btn-print">
                                <i class="fas fa-print"></i> Print Batch Card
                            </button>
                            <button onclick="saveBatch()" class="btn-save">
                                <i class="fas fa-save"></i> Save to System
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scan QR Tab -->
            <div id="scan" class="tab-content">
                <div class="scan-container">
                    <div class="scanner-section">
                        <div id="qr-reader"></div>
                        
                        <div class="scan-instructions">
                            <h3><i class="fas fa-info-circle"></i> Scanning Instructions:</h3>
                            <ol>
                                <li><strong>Position QR Code:</strong> Hold the batch card QR code within the scanner frame</li>
                                <li><strong>Camera Access:</strong> Allow camera access when prompted by your browser</li>
                                <li><strong>Auto-Scan:</strong> The system will automatically detect and scan the QR code</li>
                                <li><strong>Select Process:</strong> Choose the current process step from the list</li>
                                <li><strong>Mark Complete:</strong> Click "Mark as Complete" to update the batch status</li>
                                <li><strong>Note:</strong> Each process step can only be completed once per batch</li>
                            </ol>
                            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid var(--warning);">
                                <strong><i class="fas fa-exclamation-triangle"></i> Important:</strong> Ensure proper lighting and steady hands for best scanning results.
                            </div>
                        </div>
                    </div>

                    <div class="process-section" id="process-section">
                        <h2 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-clipboard-list"></i> Batch Processing
                        </h2>
                        
                        <div class="batch-info">
                            <p><strong>Batch ID:</strong> <span id="scan-batch-id"></span></p>
                            <p><strong>Client:</strong> <span id="scan-client"></span></p>
                            <p><strong>Style:</strong> <span id="scan-style"></span></p>
                            <p><strong>Garment:</strong> <span id="scan-garment"></span></p>
                            <p><strong>Status:</strong> <span id="scan-status" class="status-active"></span></p>
                        </div>

                        <h3 style="color: var(--dark); margin: 25px 0 15px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-tasks"></i> Select Process Step to Complete
                        </h3>
                        
                        <div class="process-steps-grid" id="process-steps">
                            <!-- Process steps will be loaded here -->
                        </div>

                        <button onclick="completeProcess()" class="btn-complete" id="complete-btn" disabled>
                            <i class="fas fa-check-circle"></i> Mark Selected Step as Complete
                        </button>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #e8f4fc; border-radius: 5px; border-left: 4px solid var(--secondary);">
                            <strong><i class="fas fa-lightbulb"></i> Tip:</strong> Click on the current process step your batch is completing. Each step can only be marked once.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2 style="color: var(--primary); margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-chart-bar"></i> Production Reports & Analytics
                </h2>
                
                <div class="reports-grid">
                    <div class="report-card" onclick="generateDailyReport()">
                        <h3><i class="fas fa-calendar-day"></i> Daily Production Report</h3>
                        <p>View today's batch completion status, productivity metrics, and worker efficiency reports.</p>
                    </div>
                    
                    <div class="report-card" onclick="generateClientReport()">
                        <h3><i class="fas fa-users"></i> Client-wise Analysis</h3>
                        <p>Analyze production data by client, track delivery timelines, and view client-specific metrics.</p>
                    </div>
                    
                    <div class="report-card" onclick="generateEfficiencyReport()">
                        <h3><i class="fas fa-chart-line"></i> Process Efficiency</h3>
                        <p>Monitor time taken at each process step, identify bottlenecks, and optimize workflow.</p>
                    </div>
                    
                    <div class="report-card" onclick="exportAllData()">
                        <h3><i class="fas fa-file-export"></i> Export All Data</h3>
                        <p>Export complete batch history, process logs, and production data for external analysis.</p>
                    </div>
                </div>
                
                <div id="report-output" style="margin-top: 40px;">
                    <!-- Reports will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Fakir Apparels Limited - Washing Plant Management System © 2024</p>
            <p style="font-size: 0.8rem; margin-top: 5px;">Version 1.0 | All data is stored locally on this device</p>
        </div>
    </div>

    <script>
        // Define all process steps
        const PROCESS_STEPS = [
            { id: 'receiving', name: 'Receiving', icon: 'fas fa-truck-loading', time: 5 },
            { id: 'inspection', name: 'Inspection', icon: 'fas fa-search', time: 10 },
            { id: 'pre_wash', name: 'Pre-Wash', icon: 'fas fa-soap', time: 30 },
            { id: 'main_wash', name: 'Main Wash', icon: 'fas fa-shower', time: 45 },
            { id: 'rinse', name: 'Rinse', icon: 'fas fa-faucet', time: 15 },
            { id: 'softening', name: 'Softening', icon: 'fas fa-cloud', time: 20 },
            { id: 'drying', name: 'Drying', icon: 'fas fa-wind', time: 60 },
            { id: 'pressing', name: 'Pressing', icon: 'fas fa-tshirt', time: 25 },
            { id: 'inspection_final', name: 'Final Inspection', icon: 'fas fa-clipboard-check', time: 15 },
            { id: 'packing', name: 'Packing', icon: 'fas fa-box', time: 20 },
            { id: 'dispatch', name: 'Dispatch', icon: 'fas fa-shipping-fast', time: 10 }
        ];

        // Global variables
        let currentBatchId = null;
        let selectedProcessStep = null;
        let html5QrCode = null;
        let tempBatchData = null;

        // Initialize the application
        function initializeApp() {
            if (!localStorage.getItem('batches')) {
                localStorage.setItem('batches', JSON.stringify([]));
            }
            if (!localStorage.getItem('processLogs')) {
                localStorage.setItem('processLogs', JSON.stringify([]));
            }
            
            // Load dashboard on startup
            loadDashboard();
            
            // Initialize QR scanner if on scan tab
            if (document.getElementById('scan').classList.contains('active')) {
                initializeScanner();
            }
            
            // Set today's date in generate form
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('style-number').value = `STYLE-${today.replace(/-/g, '')}-001`;
            document.getElementById('lot-number').value = `LOT-${today.replace(/-/g, '').substring(2)}-001`;
        }

        // Switch between tabs
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.closest('.nav-tab').classList.add('active');
            
            // Initialize scanner if switching to scan tab
            if (tabName === 'scan') {
                setTimeout(initializeScanner, 100);
            }
            
            // Load dashboard data if switching to dashboard
            if (tabName === 'dashboard') {
                loadDashboard();
            }
            
            // Reset generate form if switching to generate tab
            if (tabName === 'generate') {
                document.getElementById('batch-form').reset();
                document.getElementById('batch-card-preview').style.display = 'none';
            }
        }

        // Generate a unique batch ID
        function generateBatchId() {
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substr(2, 5);
            const prefix = 'FAKIR';
            return `${prefix}-${timestamp}-${random}`.toUpperCase();
        }

        // Generate batch card
        function generateBatchCard(event) {
            event.preventDefault();
            
            // Get form values
            const client = document.getElementById('client-name').value;
            const style = document.getElementById('style-number').value;
            const lot = document.getElementById('lot-number').value;
            const garment = document.getElementById('garment-type').value;
            const quantity = document.getElementById('quantity').value;
            const color = document.getElementById('color').value;
            const priority = document.getElementById('priority').value;
            const operator = document.getElementById('operator').value;
            
            // Generate batch ID and date
            const batchId = generateBatchId();
            const currentDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Display batch details
            document.getElementById('display-batch-id').textContent = batchId;
            document.getElementById('display-client').textContent = client;
            document.getElementById('display-style').textContent = style;
            document.getElementById('display-lot').textContent = lot;
            document.getElementById('display-garment').textContent = garment;
            document.getElementById('display-quantity').textContent = `${quantity} pcs`;
            document.getElementById('display-color').textContent = color;
            document.getElementById('display-priority').textContent = priority.toUpperCase();
            document.getElementById('display-operator').textContent = operator;
            document.getElementById('display-date').textContent = currentDate;
            
            // Generate QR Code
            document.getElementById('qrcode').innerHTML = '';
            QRCode.toCanvas(document.getElementById('qrcode'), batchId, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function(error) {
                if (error) console.error(error);
            });
            
            // Show batch card preview
            document.getElementById('batch-card-preview').style.display = 'block';
            document.getElementById('batch-card-preview').scrollIntoView({ behavior: 'smooth' });
            
            // Store batch data temporarily for saving
            tempBatchData = {
                batchId,
                client,
                style,
                lot,
                garment,
                quantity: parseInt(quantity),
                color,
                priority,
                operator,
                date: currentDate,
                createdAt: new Date().toISOString(),
                completedSteps: [],
                status: 'active',
                lastUpdated: new Date().toISOString()
            };
        }

        // Save batch to localStorage
        function saveBatch() {
            if (!tempBatchData) {
                alert('Please generate a batch card first!');
                return;
            }
            
            const batches = JSON.parse(localStorage.getItem('batches')) || [];
            batches.push(tempBatchData);
            localStorage.setItem('batches', JSON.stringify(batches));
            
            // Show success message
            alert(`✅ Batch ${tempBatchData.batchId} saved successfully!\n\nClient: ${tempBatchData.client}\nStyle: ${tempBatchData.style}\nQuantity: ${tempBatchData.quantity} pcs`);
            
            // Switch to dashboard and refresh
            switchTab('dashboard');
            loadDashboard();
            
            // Reset form
            document.getElementById('batch-form').reset();
            document.getElementById('batch-card-preview').style.display = 'none';
            tempBatchData = null;
        }

        // Print batch card
        function printBatchCard() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Print Batch Card - ${tempBatchData.batchId}</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            padding: 20px; 
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        .print-card { 
                            border: 3px solid #000; 
                            padding: 25px; 
                            border-radius: 10px;
                            page-break-inside: avoid;
                        }
                        .print-header {
                            text-align: center;
                            margin-bottom: 25px;
                            border-bottom: 2px solid #000;
                            padding-bottom: 15px;
                        }
                        .print-header h1 {
                            color: #2c3e50;
                            margin: 0;
                            font-size: 24px;
                        }
                        .print-header h2 {
                            color: #3498db;
                            margin: 5px 0 0 0;
                            font-size: 18px;
                        }
                        .print-content {
                            display: flex;
                            gap: 30px;
                            margin: 25px 0;
                        }
                        .qr-print {
                            padding: 15px;
                            border: 2px solid #ddd;
                            border-radius: 5px;
                            text-align: center;
                        }
                        .qr-print canvas {
                            max-width: 180px;
                        }
                        .details-table {
                            flex: 1;
                            border-collapse: collapse;
                            width: 100%;
                        }
                        .details-table td {
                            padding: 10px;
                            border-bottom: 1px solid #eee;
                        }
                        .details-table td:first-child {
                            font-weight: bold;
                            color: #2c3e50;
                            width: 150px;
                        }
                        .print-footer {
                            text-align: center;
                            margin-top: 25px;
                            padding-top: 15px;
                            border-top: 2px solid #000;
                            font-size: 12px;
                            color: #666;
                        }
                        @media print {
                            .print-card {
                                border: 2px solid #000;
                            }
                            .no-print {
                                display: none;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-card">
                        <div class="print-header">
                            <h1>FAKIR APPARELS LTD.</h1>
                            <h2>Washing Plant Batch Card</h2>
                        </div>
                        
                        <div class="print-content">
                            <div class="qr-print">
                                <div id="qrcode-print"></div>
                                <p style="margin-top: 10px; font-size: 12px;">Scan QR code at each process step</p>
                            </div>
                            
                            <table class="details-table">
                                <tr><td>Batch ID:</td><td>${tempBatchData.batchId}</td></tr>
                                <tr><td>Client:</td><td>${tempBatchData.client}</td></tr>
                                <tr><td>Style:</td><td>${tempBatchData.style}</td></tr>
                                <tr><td>Lot Number:</td><td>${tempBatchData.lot}</td></tr>
                                <tr><td>Garment Type:</td><td>${tempBatchData.garment}</td></tr>
                                <tr><td>Quantity:</td><td>${tempBatchData.quantity} pcs</td></tr>
                                <tr><td>Color:</td><td>${tempBatchData.color}</td></tr>
                                <tr><td>Priority:</td><td>${tempBatchData.priority.toUpperCase()}</td></tr>
                                <tr><td>Operator:</td><td>${tempBatchData.operator}</td></tr>
                                <tr><td>Date:</td><td>${tempBatchData.date}</td></tr>
                            </table>
                        </div>
                        
                        <div class="print-footer">
                            <p><strong>Process Steps:</strong> Receiving → Inspection → Pre-Wash → Main Wash → Rinse → Softening → Drying → Pressing → Final Inspection → Packing → Dispatch</p>
                            <p style="margin-top: 10px;">Each step must be scanned before proceeding to next step | One scan per step only</p>
                        </div>
                    </div>
                    
                    <div class="no-print" style="text-align: center; margin-top: 20px;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Print Now
                        </button>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                            Close
                        </button>
                    </div>
                    
                    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"><\/script>
                    <script>
                        // Generate QR code for print
                        QRCode.toCanvas(document.getElementById('qrcode-print'), '${tempBatchData.batchId}', {
                            width: 180,
                            margin: 1,
                            color: { dark: '#000000', light: '#FFFFFF' }
                        });
                        
                        // Auto print after loading
                        window.onload = function() {
                            setTimeout(() => {
                                window.print();
                            }, 500);
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Initialize QR Scanner
        function initializeScanner() {
            if (!html5QrCode && document.getElementById('qr-reader')) {
                html5QrCode = new Html5Qrcode("qr-reader");
                const config = { fps: 10, qrbox: { width: 250, height: 250 } };
                
                html5QrCode.start(
                    { facingMode: "environment" },
                    config,
                    onScanSuccess,
                    onScanError
                ).catch(err => {
                    console.log("Error starting scanner:", err);
                });
            }
        }

        // Handle successful QR scan
        function onScanSuccess(decodedText) {
            const batchId = decodedText.trim();
            currentBatchId = batchId;
            
            // Stop scanner temporarily
            if (html5QrCode) {
                html5QrCode.stop();
            }
            
            // Load batch data
            const batches = JSON.parse(localStorage.getItem('batches')) || [];
            const batch = batches.find(b => b.batchId === batchId);
            
            if (batch) {
                // Update UI with batch info
                document.getElementById('scan-batch-id').textContent = batch.batchId;
                document.getElementById('scan-client').textContent = batch.client;
                document.getElementById('scan-style').textContent = batch.style;
                document.getElementById('scan-garment').textContent = batch.garment;
                
                // Update status
                const statusElement = document.getElementById('scan-status');
                statusElement.textContent = batch.status.toUpperCase();
                statusElement.className = `status-${batch.status}`;
                
                // Load process steps
                loadProcessStepsForScan(batch);
                
                // Show process section
                document.getElementById('process-section').classList.add('active');
                
                // Play success sound (optional)
                playBeepSound();
                
                // Show success message
                showNotification(`✅ Batch ${batchId} loaded successfully!`, 'success');
            } else {
                showNotification(`❌ Batch ${batchId} not found!`, 'error');
                // Restart scanner
                setTimeout(() => {
                    if (html5QrCode) {
                        html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: { width: 250, height: 250 } }, onScanSuccess, onScanError);
                    }
                }, 2000);
            }
        }

        // Handle scan error
        function onScanError(error) {
            // console.log("QR Scan Error:", error);
        }

        // Load process steps for scanning interface
        function loadProcessStepsForScan(batch) {
            const completedSteps = batch.completedSteps || [];
            const processStepsDiv = document.getElementById('process-steps');
            processStepsDiv.innerHTML = '';
            
            PROCESS_STEPS.forEach(step => {
                const isCompleted = completedSteps.includes(step.id);
                const stepElement = document.createElement('div');
                stepElement.className = `process-step ${isCompleted ? 'completed' : ''}`;
                stepElement.innerHTML = `
                    <i class="${step.icon}"></i>
                    <div style="font-weight: 600;">${step.name}</div>
                    <div style="font-size: 0.8rem; color: #666;">${step.time} mins</div>
                    ${isCompleted ? '<div style="font-size: 0.7rem; color: #27ae60;"><i class="fas fa-check"></i> Completed</div>' : ''}
                `;
                
                if (!isCompleted) {
                    stepElement.onclick = () => selectProcessStepForCompletion(step.id, step.name);
                }
                
                processStepsDiv.appendChild(stepElement);
            });
            
            // Reset selection
            selectedProcessStep = null;
            document.getElementById('complete-btn').disabled = true;
        }

        // Select process step for completion
        function selectProcessStepForCompletion(stepId, stepName) {
            selectedProcessStep = stepId;
            
            // Remove selection from all steps
            document.querySelectorAll('.process-step').forEach(step => {
                step.classList.remove('selected');
            });
            
            // Add selection to clicked step
            document.querySelectorAll('.process-step').forEach(step => {
                if (step.querySelector('div[style*="font-weight: 600;"]')?.textContent === stepName) {
                    step.classList.add('selected');
                }
            });
            
            // Enable complete button
            document.getElementById('complete-btn').disabled = false;
            
            // Show confirmation
            showNotification(`Selected: ${stepName}`, 'info');
        }

        // Complete selected process step
        function completeProcess() {
            if (!selectedProcessStep || !currentBatchId) {
                showNotification('Please select a process step first!', 'error');
                return;
            }
            
            const batches = JSON.parse(localStorage.getItem('batches')) || [];
            const batchIndex = batches.findIndex(b => b.batchId === currentBatchId);
            
            if (batchIndex === -1) {
                showNotification('Batch not found!', 'error');
                return;
            }
            
            const batch = batches[batchIndex];
            
            // Check if step is already completed
            if (batch.completedSteps?.includes(selectedProcessStep)) {
                showNotification('This step has already been completed!', 'error');
                return;
            }
            
            // Add step to completed steps
            if (!batch.completedSteps) batch.completedSteps = [];
            batch.completedSteps.push(selectedProcessStep);
            
            // Update last updated timestamp
            batch.lastUpdated = new Date().toISOString();
            
            // Update status if all steps are completed
            if (batch.completedSteps.length === PROCESS_STEPS.length) {
                batch.status = 'completed';
                batch.completedAt = new Date().toISOString();
            }
            
            // Save process log
            const processLogs = JSON.parse(localStorage.getItem('processLogs')) || [];
            processLogs.push({
                batchId: currentBatchId,
                step: selectedProcessStep,
                completedAt: new Date().toISOString(),
                operator: 'Worker (Scanner)',
                client: batch.client,
                style: batch.style
            });
            localStorage.setItem('processLogs', JSON.stringify(processLogs));
            
            // Save updated batch
            batches[batchIndex] = batch;
            localStorage.setItem('batches', JSON.stringify(batches));
            
            // Show success message
            const stepName = PROCESS_STEPS.find(s => s.id === selectedProcessStep)?.name || selectedProcessStep;
            showNotification(`✅ ${stepName} marked as complete for batch ${currentBatchId}!`, 'success');
            
            // Play completion sound (optional)
            playCompletionSound();
            
            // Update UI
            setTimeout(() => {
                // Reload process steps
                loadProcessStepsForScan(batch);
                
                // Update batch info
                document.getElementById('scan-status').textContent = batch.status.toUpperCase();
                document.getElementById('scan-status').className = `status-${batch.status}`;
                
                // Reset selection
                selectedProcessStep = null;
                document.getElementById('complete-btn').disabled = true;
                
                // Restart scanner after 2 seconds
                setTimeout(() => {
                    if (html5QrCode) {
                        html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: { width: 250, height: 250 } }, onScanSuccess, onScanError);
                    }
                    document.getElementById('process-section').classList.remove('active');
                }, 2000);
                
            }, 1500);
        }

        // Load dashboard data
        function loadDashboard() {
            const batches = JSON.parse(localStorage.getItem('batches')) || [];
            
            // Apply filters
            const filterClient = document.getElementById('filter-client')?.value || 'all';
            const filterStatus = document.getElementById('filter-status')?.value || 'all';
            const searchTerm = (document.getElementById('search-batch')?.value || '').toLowerCase();
            
            let filteredBatches = batches;
            
            if (filterClient !== 'all') {
                filteredBatches = filteredBatches.filter(batch => batch.client === filterClient);
            }
            
            if (filterStatus !== 'all') {
                filteredBatches = filteredBatches.filter(batch => batch.status === filterStatus);
            }
            
            if (searchTerm) {
                filteredBatches = filteredBatches.filter(batch => 
                    batch.batchId.toLowerCase().includes(searchTerm) ||
                    batch.style.toLowerCase().includes(searchTerm) ||
                    batch.lot.toLowerCase().includes(searchTerm) ||
                    batch.garment.toLowerCase().includes(searchTerm)
                );
            }
            
            // Update statistics
            const activeBatches = batches.filter(b => b.status === 'active').length;
            const completedBatches = batches.filter(b => b.status === 'completed').length;
            const today = new Date().toISOString().split('T')[0];
            const todayBatches = batches.filter(b => b.createdAt?.split('T')[0] === today).length;
            const totalPendingSteps = batches.reduce((total, batch) => {
                return total + (PROCESS_STEPS.length - (batch.completedSteps?.length || 0));
            }, 0);
            
            if (document.getElementById('stat-active')) {
                document.getElementById('stat-active').textContent = activeBatches;
                document.getElementById('stat-completed').textContent = completedBatches;
                document.getElementById('stat-pending').textContent = totalPendingSteps;
                document.getElementById('stat-today').textContent = todayBatches;
            }
            
            // Display batches
            const batchesContainer = document.getElementById('batches-container');
            if (!batchesContainer) return;
            
            batchesContainer.innerHTML = '';
            
            if (filteredBatches.length === 0) {
                batchesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No batches found</h3>
                        <p>${batches.length === 0 ? 'Start by generating your first batch card' : 'Try adjusting your filters or search term'}</p>
                    </div>
                `;
                return;
            }
            
            // Sort by last updated (newest first)
            filteredBatches.sort((a, b) => new Date(b.lastUpdated || b.createdAt) - new Date(a.lastUpdated || a.createdAt));
            
            filteredBatches.forEach(batch => {
                const completedSteps = batch.completedSteps || [];
                const progress = (completedSteps.length / PROCESS_STEPS.length) * 100;
                const statusClass = `status-${batch.status}`;
                
                const batchElement = document.createElement('div');
                batchElement.className = 'batch-item';
                batchElement.innerHTML = `
                    <div class="batch-header">
                        <div class="batch-id">${batch.batchId}</div>
                        <div class="batch-client">${batch.client}</div>
                    </div>
                    
                    <div class="batch-details">
                        <div class="batch-detail-item">
                            <span class="batch-detail-label">Style Number</span>
                            <span class="batch-detail-value">${batch.style}</span>
                        </div>
                        <div class="batch-detail-item">
                            <span class="batch-detail-label">Lot Number</span>
                            <span class="batch-detail-value">${batch.lot}</span>
                        </div>
                        <div class="batch-detail-item">
                            <span class="batch-detail-label">Garment Type</span>
                            <span class="batch-detail-value">${batch.garment}</span>
                        </div>
                        <div class="batch-detail-item">
                            <span class="batch-detail-label">Quantity</span>
                            <span class="batch-detail-value">${batch.quantity} pcs</span>
                        </div>
                        <div class="batch-detail-item">
                            <span class="batch-detail-label">Color</span>
                            <span class="batch-detail-value">${batch.color}</span>
                        </div>
                        <div class="batch-detail-item">
                            <span class="batch-detail-label">Status</span>
                            <span class="batch-detail-value ${statusClass}">${batch.status.toUpperCase()}</span>
                        </div>
                        <div class="batch-detail-item">
                            <span class="batch-detail-label">Progress</span>
                            <span class="batch-detail-value">${completedSteps.length}/${PROCESS_STEPS.length} steps</span>
                        </div>
                        <div class="batch-detail-item">
                            <span class="batch-detail-label">Created</span>
                            <span class="batch-detail-value">${batch.date}</span>
                        </div>
                    </div>
                    
                    <div class="progress-section">
                        <div class="progress-header">
                            <div class="progress-text">Production Progress</div>
                            <div class="progress-text">${Math.round(progress)}%</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        
                        <div class="steps-container">
                            ${PROCESS_STEPS.slice(0, 6).map(step => `
                                <div class="step-badge ${completedSteps.includes(step.id) ? 'completed' : 'pending'}">
                                    <i class="${step.icon}"></i>
                                    ${completedSteps.includes(step.id) ? step.name : step.name.substring(0, 3)}
                                </div>
                            `).join('')}
                            ${PROCESS_STEPS.length > 6 ? `
                                <div class="step-badge pending">
                                    <i class="fas fa-ellipsis-h"></i>
                                    +${PROCESS_STEPS.length - 6}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                batchesContainer.appendChild(batchElement);
            });
        }

        // Generate daily report
        function generateDailyReport() {
            const batches = JSON.parse(localStorage.getItem('batches')) || [];
            const today = new Date().toISOString().split('T')[0];
            
            const todayBatches = batches.filter(b => b.createdAt?.split('T')[0] === today);
            const completedToday = batches.filter(b => b.completedAt?.split('T')[0] === today);
            
            const output = document.getElementById('report-output');
            output.innerHTML = `
                <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-calendar-day"></i> Daily Production Report - ${new Date().toLocaleDateString()}
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div style="text-align: center; padding: 20px; background: #e8f4fc; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--secondary);">${todayBatches.length}</div>
                            <div style="color: var(--dark); font-weight: 600;">New Batches Today</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #d5f4e6; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--success);">${completedToday.length}</div>
                            <div style="color: var(--dark); font-weight: 600;">Completed Today</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #fff3cd; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--warning);">${todayBatches.length - completedToday.length}</div>
                            <div style="color: var(--dark); font-weight: 600;">In Progress</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px;">
                        <h4 style="color: var(--dark); margin-bottom: 15px;">Today's Batch Details:</h4>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: var(--light);">
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--gray);">Batch ID</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--gray);">Client</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--gray);">Progress</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--gray);">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${todayBatches.map(batch => `
                                        <tr style="border-bottom: 1px solid #eee;">
                                            <td style="padding: 12px;">${batch.batchId}</td>
                                            <td style="padding: 12px;">${batch.client}</td>
                                            <td style="padding: 12px;">
                                                <div style="display: flex; align-items: center; gap: 10px;">
                                                    <div style="flex: 1; height: 8px; background: var(--light); border-radius: 4px;">
                                                        <div style="width: ${(batch.completedSteps?.length || 0) / PROCESS_STEPS.length * 100}%; height: 100%; background: var(--success); border-radius: 4px;"></div>
                                                    </div>
                                                    <span>${Math.round((batch.completedSteps?.length || 0) / PROCESS_STEPS.length * 100)}%</span>
                                                </div>
                                            </td>
                                            <td style="padding: 12px;">
                                                <span class="status-${batch.status}">${batch.status.toUpperCase()}</span>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div style="margin-top: 25px; text-align: center;">
                        <button onclick="printReport()" style="padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
                            <i class="fas fa-print"></i> Print Report
                        </button>
                    </div>
                </div>
            `;
        }

        // Generate client report
        function generateClientReport() {
            const batches = JSON.parse(localStorage.getItem('batches')) || [];
            
            // Group by client
            const clientData = {};
            batches.forEach(batch => {
                if (!clientData[batch.client]) {
                    clientData[batch.client] = {
                        total: 0,
                        completed: 0,
                        active: 0,
                        totalQuantity: 0
                    };
                }
                clientData[batch.client].total++;
                clientData[batch.client].totalQuantity += batch.quantity;
                if (batch.status === 'completed') {
                    clientData[batch.client].completed++;
                } else {
                    clientData[batch.client].active++;
                }
            });
            
            const output = document.getElementById('report-output');
            output.innerHTML = `
                <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-users"></i> Client-wise Production Analysis
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px;">
                        ${Object.entries(clientData).map(([client, data]) => `
                            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border-left: 5px solid var(--secondary);">
                                <h4 style="color: var(--dark); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-building"></i> ${client}
                                </h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">${data.total}</div>
                                        <div style="color: var(--gray); font-size: 0.9rem;">Total Batches</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--success);">${data.completed}</div>
                                        <div style="color: var(--gray); font-size: 0.9rem;">Completed</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--secondary);">${data.active}</div>
                                        <div style="color: var(--gray); font-size: 0.9rem;">Active</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--warning);">${data.totalQuantity}</div>
                                        <div style="color: var(--gray); font-size: 0.9rem;">Total Pieces</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Export all data
        function exportAllData() {
            const batches = JSON.parse(localStorage.getItem('batches')) || [];
            const processLogs = JSON.parse(localStorage.getItem('processLogs')) || [];
            
            const data = {
                exportDate: new Date().toISOString(),
                totalBatches: batches.length,
                totalProcessLogs: processLogs.length,
                batches: batches,
                processLogs: processLogs,
                processSteps: PROCESS_STEPS
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `fakir-apparels-export-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('✅ All data exported successfully!', 'success');
        }

        // Print report
        function printReport() {
            window.print();
        }

        // Show notification
        function showNotification(message, type = 'info') {
            // Remove existing notification
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            
            const icon = type === 'success' ? 'fas fa-check-circle' : type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle';
            notification.innerHTML = `<i class="${icon}"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
            
            // Add animation styles
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Play beep sound for scan
        function playBeepSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (e) {
                // Audio not supported, silent fail
            }
        }

        // Play completion sound
        function playCompletionSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 1200;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Audio not supported, silent fail
            }
        }

        // Initialize app on load
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Add beforeunload event to stop scanner
        window.addEventListener('beforeunload', function() {
            if (html5QrCode) {
                html5QrCode.stop();
            }
        });
    </script>
</body>
</html>
